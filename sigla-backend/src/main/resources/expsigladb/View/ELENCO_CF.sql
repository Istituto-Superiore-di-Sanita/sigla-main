--------------------------------------------------------
--  DDL for View ELENCO_CF
--------------------------------------------------------

  CREATE OR REPLACE FORCE VIEW "ELENCO_CF" ("ESERCIZIO", "CL002001", "CL003001", "CL004001", "CL004002", "CL005001", "CL006001", "CL007001", "CL008001", "CL008002", "CL009001", "CL010001", "CL011001", "FR002001", "FR003001", "FR004001", "FR004002", "FR005001", "FR006001", "FR007001", "FR008001", "FR009001", "FR009002", "FR010001", "FR011001", "FR012001", "FR013001", "PROG") AS 
  SELECT
ESERCIZIO,
CL002001,
CL003001,
CL004001,
CL004002,
CL005001,
CL006001,
CL007001,
CL008001,
CL008002,
CL009001,
CL010001,
CL011001,
FR002001,
FR003001,
FR004001,
FR004002,
FR005001,
FR006001,
FR007001,
FR008001,
FR009001,
FR009002,
FR010001,
FR011001,
FR012001,
FR013001,
ROWNUM
FROM
(SELECT
ESERCIZIO,
CL002001,
CL003001,
SUM(CL004001) CL004001,
SUM(CL004002) CL004002,
SUM(CL005001) CL005001,
SUM(CL006001) CL006001,
SUM(CL007001) CL007001,
SUM(CL008001) CL008001,
SUM(CL008002) CL008002,
SUM(CL009001) CL009001,
SUM(CL010001) CL010001,
SUM(CL011001) CL011001,
FR002001,
FR003001,
SUM(FR004001) FR004001,
SUM(FR004002) FR004002,
SUM(FR005001) FR005001,
SUM(FR006001) FR006001,
SUM(FR007001) FR007001,
SUM(FR008001) FR008001,
SUM(FR009001) FR009001,
SUM(FR009002) FR009002,
SUM(FR010001) FR010001,
SUM(FR011001) FR011001,
SUM(FR012001) FR012001,
SUM(FR013001) FR013001
FROM (
 ---- ELENCO CLIENTI----
 -----------------------
 ---- CL004001 - CL004002 -- OPERAZIONI IMPONIBILI ----
 SELECT  TO_NUMBER(TO_CHAR(F.DT_EMISSIONE, 'YYYY')) ESERCIZIO ,
         Null CL002001,--è OBBLIGATORIO SOLO A PARTIRE DALL'ANNO DI RIFERIMENTO 2008--
  NVL(F.PARTITA_IVA, A.PARTITA_IVA) CL003001,
  SUM(DECODE(F.TI_FATTURA, 'C', -FR.IM_IMPONIBILE, FR.IM_IMPONIBILE))CL004001 ,
  SUM(DECODE(TI_FATTURA, 'C', -FR.IM_IVA, FR.IM_IVA))CL004002 ,
  0 CL005001,
  0 CL006001,
  0 CL007001,
  0 CL008001,
  0 CL008002,
  0 CL009001,
  0 CL010001,
  0 CL011001,
  NULL FR002001,
  NULL FR003001,
  0 FR004001,
  0 FR004002,
  0 FR005001,
  0 FR006001,
  0 FR007001,
  0 FR008001,
  0 FR009001,
  0 FR009002,
  0 FR010001,
  0 FR011001,
  0 FR012001,
  0 FR013001
 FROM  FATTURA_ATTIVA F,
  FATTURA_ATTIVA_RIGA FR,
  VOCE_IVA V ,
  TERZO T ,
  ANAGRAFICO A
 WHERE  F.CD_CDS = FR.CD_CDS AND
  F.CD_UNITA_ORGANIZZATIVA = FR.CD_UNITA_ORGANIZZATIVA AND
  F.ESERCIZIO = FR.ESERCIZIO AND
  F.PG_FATTURA_ATTIVA = FR.PG_FATTURA_ATTIVA AND
  V.CD_VOCE_IVA = FR.CD_VOCE_IVA AND
  T.CD_TERZO = F.CD_TERZO AND
  T.CD_ANAG = A.CD_ANAG AND
  --F.FL_INTRA_UE = 'N'  AND
  --F.FL_EXTRA_UE ='N' AND
  A.TI_ITALIANO_ESTERO NOT IN ('E', 'C', 'M') AND
  F.PROTOCOLLO_IVA IS NOT NULL AND
  V.CD_VOCE_IVA IN ('4%', '10%', '20%', 'NB', 'NC', 'ND')
 GROUP BY TO_CHAR(F.DT_EMISSIONE, 'YYYY'),
         Null,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA),
  NULL,
  NULL
 UNION ALL
 ---- CL005001 -- OPERAZIONI NON IMPONIBILI  (ESCLUSO DAL 2007 IL CODICE N1, COME RICHIESTO DALLA NOTA 32/2008)----
 SELECT  TO_NUMBER(TO_CHAR(F.DT_EMISSIONE, 'YYYY')) ESERCIZIO ,
  NULL CL002001,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA) CL003001,
  0 CL004001 ,
  0 CL004002 ,
  SUM( DECODE(F.TI_FATTURA, 'C', -FR.IM_IMPONIBILE, FR.IM_IMPONIBILE)) CL005001,
  0 CL006001,
  0 CL007001,
  0 CL008001,
  0 CL008002,
  0 CL009001,
  0 CL010001,
  0 CL011001,
  NULL FR002001,
  NULL FR003001,
  0 FR004001,
  0 FR004002,
  0 FR005001,
  0 FR006001,
  0 FR007001,
  0 FR008001,
  0 FR009001,
  0 FR009002,
  0 FR010001,
  0 FR011001,
  0 FR012001,
  0 FR013001
 FROM  FATTURA_ATTIVA F,
  FATTURA_ATTIVA_RIGA FR,
  VOCE_IVA V ,
  TERZO T ,
  ANAGRAFICO A
 WHERE  F.CD_CDS = FR.CD_CDS AND
  F.CD_UNITA_ORGANIZZATIVA = FR.CD_UNITA_ORGANIZZATIVA AND
  F.ESERCIZIO = FR.ESERCIZIO AND
  F.PG_FATTURA_ATTIVA = FR.PG_FATTURA_ATTIVA AND
  V.CD_VOCE_IVA = FR.CD_VOCE_IVA AND
  T.CD_TERZO = F.CD_TERZO AND
  T.CD_ANAG = A.CD_ANAG AND
  --F.FL_INTRA_UE = 'N'  AND
  --F.FL_EXTRA_UE ='N' AND
  F.PROTOCOLLO_IVA IS NOT NULL AND
  A.TI_ITALIANO_ESTERO NOT IN ('E', 'C') AND
  V.CD_VOCE_IVA IN (/*'N1',*/ 'N2', 'N3', 'N4', 'N5', 'N8')
 GROUP BY TO_CHAR(F.DT_EMISSIONE, 'YYYY'),
         Null,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA),
  NULL,
  NULL
 UNION ALL
 ---- CL006001 -- OPERAZIONI ESENTI ----
 SELECT   TO_NUMBER(TO_CHAR(F.DT_EMISSIONE, 'YYYY'))  ESERCIZIO ,
         NULL CL002001,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA) CL003001,
  0 CL004001 ,
  0 CL004002 ,
  0 CL005001,
  SUM( DECODE(F.TI_FATTURA, 'C', -FR.IM_IMPONIBILE, FR.IM_IMPONIBILE)) CL006001,
  0 CL007001,
  0 CL008001,
  0 CL008002,
  0 CL009001,
  0 CL010001,
  0 CL011001,
  NULL FR002001,
  NULL FR003001,
  0 FR004001,
  0 FR004002,
  0 FR005001,
  0 FR006001,
  0 FR007001,
  0 FR008001,
  0 FR009001,
  0 FR009002,
  0 FR010001,
  0 FR011001,
  0 FR012001,
  0 FR013001
 FROM  FATTURA_ATTIVA F,
  FATTURA_ATTIVA_RIGA FR,
  VOCE_IVA V ,
  TERZO T ,
  ANAGRAFICO A
 WHERE  F.CD_CDS = FR.CD_CDS AND
  F.CD_UNITA_ORGANIZZATIVA = FR.CD_UNITA_ORGANIZZATIVA AND
  F.ESERCIZIO = FR.ESERCIZIO AND
  F.PG_FATTURA_ATTIVA = FR.PG_FATTURA_ATTIVA AND
  V.CD_VOCE_IVA = FR.CD_VOCE_IVA AND
  T.CD_TERZO = F.CD_TERZO AND
  T.CD_ANAG = A.CD_ANAG AND
  --F.FL_INTRA_UE = 'N'  AND
  --F.FL_EXTRA_UE ='N' AND
  A.TI_ITALIANO_ESTERO NOT IN ('E', 'C') AND
  F.PROTOCOLLO_IVA IS NOT NULL AND
  V.CD_VOCE_IVA = 'ES'
 GROUP BY TO_CHAR(F.DT_EMISSIONE, 'YYYY'),
         Null,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA),
  NULL,
  NULL
 union All
 ---- CL008001- CL008002- NOTE DI VARIAZIONE DI OPERAZIONI IMPONIBILI EMESSE NELL'ANNO MA RIFERITE AD ESERCIZI PRECEDENTI ----
 SELECT  TO_NUMBER(TO_CHAR(F.DT_EMISSIONE, 'YYYY')) ESERCIZIO ,
         Null CL002001,--è OBBLIGATORIO SOLO A PARTIRE DALL'ANNO DI RIFERIMENTO 2008--
  NVL(F.PARTITA_IVA, A.PARTITA_IVA) CL003001,
  0 CL004001 ,
  0 CL004002 ,
  0 CL005001,
  0 CL006001,
  0 CL007001,
  SUM(DECODE(F.TI_FATTURA, 'C', FR.IM_IMPONIBILE, 0))CL008001,
  SUM(DECODE(TI_FATTURA, 'C', FR.IM_IVA, 0))CL008002,
  0 CL009001,
  0 CL010001,
  0 CL011001,
  NULL FR002001,
  NULL FR003001,
  0 FR004001,
  0 FR004002,
  0 FR005001,
  0 FR006001,
  0 FR007001,
  0 FR008001,
  0 FR009001,
  0 FR009002,
  0 FR010001,
  0 FR011001,
  0 FR012001,
  0 FR013001
 FROM  FATTURA_ATTIVA F,
  FATTURA_ATTIVA_RIGA FR,
  VOCE_IVA V ,
  TERZO T ,
  ANAGRAFICO A
 WHERE  F.CD_CDS = FR.CD_CDS AND
  F.CD_UNITA_ORGANIZZATIVA = FR.CD_UNITA_ORGANIZZATIVA AND
  F.ESERCIZIO = FR.ESERCIZIO AND
  F.PG_FATTURA_ATTIVA = FR.PG_FATTURA_ATTIVA AND
  V.CD_VOCE_IVA = FR.CD_VOCE_IVA AND
  T.CD_TERZO = F.CD_TERZO AND
  T.CD_ANAG = A.CD_ANAG AND
  --F.FL_INTRA_UE = 'N'  AND
  --F.FL_EXTRA_UE ='N' AND
  A.TI_ITALIANO_ESTERO NOT IN ('E', 'C') AND
  F.PROTOCOLLO_IVA IS NOT NULL AND
  V.CD_VOCE_IVA IN ('4%', '10%', '20%', 'NB', 'NC', 'ND') And
  F.TI_FATTURA = 'C' AND
  TO_CHAR(FR.DT_DA_COMPETENZA_COGE, 'YYYY') != TO_CHAR(F.DT_EMISSIONE, 'YYYY')
 GROUP BY TO_CHAR(F.DT_EMISSIONE, 'YYYY'),
         Null,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA),
  NULL,
  NULL
 UNION All
 ---- CL009001 -- NOTE DI VARIAZIONE DI OPERAZIONI NON IMPONIBILI EMESSE NELL'ANNO MA RIFERITE AD ESERCIZI PRECEDENTI ----
 SELECT  TO_NUMBER(TO_CHAR(F.DT_EMISSIONE, 'YYYY')) ESERCIZIO ,
  NULL CL002001,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA) CL003001,
  0 CL004001 ,
  0 CL004002 ,
  0 CL005001,
  0 CL006001,
  0 CL007001,
  0 CL008001,
  0 CL008002,
  SUM(DECODE(F.TI_FATTURA, 'C', FR.IM_IMPONIBILE, 0)) CL009001,
  0 CL010001,
  0 CL011001,
  NULL FR002001,
  NULL FR003001,
  0 FR004001,
  0 FR004002,
  0 FR005001,
  0 FR006001,
  0 FR007001,
  0 FR008001,
  0 FR009001,
  0 FR009002,
  0 FR010001,
  0 FR011001,
  0 FR012001,
  0 FR013001
 FROM  FATTURA_ATTIVA F,
  FATTURA_ATTIVA_RIGA FR,
  VOCE_IVA V ,
  TERZO T ,
  ANAGRAFICO A
 WHERE  F.CD_CDS = FR.CD_CDS AND
  F.CD_UNITA_ORGANIZZATIVA = FR.CD_UNITA_ORGANIZZATIVA AND
  F.ESERCIZIO = FR.ESERCIZIO AND
  F.PG_FATTURA_ATTIVA = FR.PG_FATTURA_ATTIVA AND
  V.CD_VOCE_IVA = FR.CD_VOCE_IVA AND
  T.CD_TERZO = F.CD_TERZO AND
  T.CD_ANAG = A.CD_ANAG AND
  --F.FL_INTRA_UE = 'N'  AND
  --F.FL_EXTRA_UE ='N' AND
  F.PROTOCOLLO_IVA IS NOT NULL AND
  A.TI_ITALIANO_ESTERO NOT IN ('E', 'C') AND
  V.CD_VOCE_IVA IN ('N1', 'N2', 'N3', 'N4', 'N5', 'N8')And
  F.TI_FATTURA = 'C' AND
  TO_CHAR(FR.DT_DA_COMPETENZA_COGE, 'YYYY') != TO_CHAR(F.DT_EMISSIONE, 'YYYY')
 GROUP BY TO_CHAR(F.DT_EMISSIONE, 'YYYY'),
         Null,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA),
  NULL,
  NULL
 UNION All
 ---- CL010001 -- NOTE DI VARIAZIONE DI OPERAZIONI ESENTI EMESSE NELL'ANNO MA RIFERITE AD ESERCIZI PRECEDENTI ----
 SELECT   TO_NUMBER(TO_CHAR(F.DT_EMISSIONE, 'YYYY'))  ESERCIZIO ,
         NULL CL002001,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA) CL003001,
  0 CL004001 ,
  0 CL004002 ,
  0 CL005001,
  0 CL006001,
  0 CL007001,
  0 CL008001,
  0 CL008002,
  0 CL009001,
  SUM(DECODE(F.TI_FATTURA, 'C', FR.IM_IMPONIBILE, 0)) CL010001,
  0 CL011001,
  NULL FR002001,
  NULL FR003001,
  0 FR004001,
  0 FR004002,
  0 FR005001,
  0 FR006001,
  0 FR007001,
  0 FR008001,
  0 FR009001,
  0 FR009002,
  0 FR010001,
  0 FR011001,
  0 FR012001,
  0 FR013001
 FROM  FATTURA_ATTIVA F,
  FATTURA_ATTIVA_RIGA FR,
  VOCE_IVA V ,
  TERZO T ,
  ANAGRAFICO A
 WHERE  F.CD_CDS = FR.CD_CDS AND
  F.CD_UNITA_ORGANIZZATIVA = FR.CD_UNITA_ORGANIZZATIVA AND
  F.ESERCIZIO = FR.ESERCIZIO AND
  F.PG_FATTURA_ATTIVA = FR.PG_FATTURA_ATTIVA AND
  V.CD_VOCE_IVA = FR.CD_VOCE_IVA AND
  T.CD_TERZO = F.CD_TERZO AND
  T.CD_ANAG = A.CD_ANAG AND
  --F.FL_INTRA_UE = 'N'  AND
  --F.FL_EXTRA_UE ='N' AND
  A.TI_ITALIANO_ESTERO NOT IN ('E', 'C') AND
  F.PROTOCOLLO_IVA IS NOT NULL AND
  V.CD_VOCE_IVA = 'ES' And
  TO_CHAR(FR.DT_DA_COMPETENZA_COGE, 'YYYY') != TO_CHAR(F.DT_EMISSIONE, 'YYYY')
 GROUP BY TO_CHAR(F.DT_EMISSIONE, 'YYYY'),
         Null,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA),
  NULL,
  NULL
 UNION All
 ---- ELENCO FORNITORI ----
 --------------------------
 ---- FR004001 -- FR004002 -- OPERAZIONI IMPONIBILI ----
 SELECT   TO_NUMBER(TO_CHAR(F.DT_FATTURA_FORNITORE, 'YYYY')) ESERCIZIO ,
  NULL CL002001,
  NULL CL003001,
  0 CL004001,
  0 CL004002,
  0 CL005001,
  0 CL006001,
  0 CL007001,
  0 CL008001,
  0 CL008002,
  0 CL009001,
  0 CL010001,
  0 CL011001,
  NULL FR002001,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA) FR003001,
  SUM( DECODE(F.TI_FATTURA, 'C', -FR.IM_IMPONIBILE, FR.IM_IMPONIBILE)) FR004001,
  SUM( DECODE(TI_FATTURA, 'C', -FR.IM_IVA, FR.IM_IVA)) FR004002,
  0 FR005001,
  0 FR006001,
  0 FR007001,
  0 FR008001,
  0 FR009001,
  0 FR009002,
  0 FR010001,
  0 FR011001,
  0 FR012001,
  0 FR013001
 FROM  FATTURA_PASSIVA F,
  FATTURA_PASSIVA_RIGA FR,
  VOCE_IVA V ,
  TERZO T ,
  ANAGRAFICO A
 WHERE  F.CD_CDS = FR.CD_CDS AND
  F.CD_UNITA_ORGANIZZATIVA = FR.CD_UNITA_ORGANIZZATIVA AND
  F.ESERCIZIO = FR.ESERCIZIO AND
  F.PG_FATTURA_PASSIVA = FR.PG_FATTURA_PASSIVA AND
  V.CD_VOCE_IVA = FR.CD_VOCE_IVA AND
  T.CD_TERZO = F.CD_TERZO AND
  T.CD_ANAG = A.CD_ANAG AND
  F.CD_TIPO_SEZIONALE = 'a/com' AND
  F.FL_INTRA_UE = 'N'  AND
  F.FL_EXTRA_UE ='N' AND
  F.FL_SAN_MARINO_SENZA_IVA = 'N' AND
  F.STATO_COFI != 'A' AND
  F.PROTOCOLLO_IVA IS NOT NULL AND
  V.CD_VOCE_IVA IN ('4%', '10%', '20%', 'NB', 'NC', 'ND')AND
  FR.CD_BENE_SERVIZIO NOT IN ('19','19A', '19L')
 GROUP BY TO_CHAR(F.DT_FATTURA_FORNITORE, 'YYYY'),
  NULL,
  NULL,
  NULL,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA)
 UNION All
 ---- FR006001 -- OPERAZIONI NON IMPONIBILI ----
 SELECT   TO_NUMBER(TO_CHAR(F.DT_FATTURA_FORNITORE, 'YYYY')) ESERCIZIO ,
  NULL CL002001,
  NULL CL003001,
  0 CL004001,
  0 CL004002,
  0 CL005001,
  0 CL006001,
  0 CL007001,
  0 CL008001,
  0 CL008002,
  0 CL009001,
  0 CL010001,
  0 CL011001,
  NULL FR002001,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA) FR003001,
  0 FR004001,
  0 FR004002,
  0 FR005001,
  SUM( DECODE(F.TI_FATTURA, 'C', -FR.IM_IMPONIBILE, FR.IM_IMPONIBILE))   FR006001,
  0 FR007001,
  0 FR008001,
  0 FR009001,
  0 FR009002,
  0 FR010001,
  0 FR011001,
  0 FR012001,
  0 FR013001
 FROM  FATTURA_PASSIVA F,
  FATTURA_PASSIVA_RIGA FR,
  VOCE_IVA V ,
  TERZO T ,
  ANAGRAFICO A
 WHERE  F.CD_CDS = FR.CD_CDS AND
  F.CD_UNITA_ORGANIZZATIVA = FR.CD_UNITA_ORGANIZZATIVA AND
  F.ESERCIZIO = FR.ESERCIZIO AND
  F.PG_FATTURA_PASSIVA = FR.PG_FATTURA_PASSIVA AND
  V.CD_VOCE_IVA = FR.CD_VOCE_IVA AND
  T.CD_TERZO = F.CD_TERZO AND
  T.CD_ANAG = A.CD_ANAG AND
  F.CD_TIPO_SEZIONALE = 'a/com' AND
  F.FL_INTRA_UE = 'N'  AND
  F.FL_EXTRA_UE ='N' AND
  F.FL_SAN_MARINO_SENZA_IVA = 'N' AND
  F.STATO_COFI != 'A' AND
  F.PROTOCOLLO_IVA IS NOT NULL AND
  V.CD_VOCE_IVA IN ('N1', 'N2', 'N3', 'N4', 'N5', 'N8')AND
  FR.CD_BENE_SERVIZIO NOT IN ('19','19A', '19L')
 GROUP BY TO_CHAR(F.DT_FATTURA_FORNITORE, 'YYYY'),
  NULL,
  NULL,
  NULL,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA)
 UNION ALL
 ---- FR007001 -- OPERAZIONI ESENTI ----
 SELECT   TO_NUMBER(TO_CHAR(F.DT_FATTURA_FORNITORE, 'YYYY')) ESERCIZIO ,
  NULL CL002001,
  NULL CL003001,
  0 CL004001,
  0 CL004002,
  0 CL005001,
  0 CL006001,
  0 CL007001,
  0 CL008001,
  0 CL008002,
  0 CL009001,
  0 CL010001,
  0 CL011001,
  NULL FR002001,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA) FR003001,
  0 FR004001,
  0 FR004002,
  0 FR005001,
  0 FR006001,
  SUM( DECODE(F.TI_FATTURA, 'C', -FR.IM_IMPONIBILE, FR.IM_IMPONIBILE)) FR007001,
  0 FR008001,
  0 FR009001,
  0 FR009002,
  0 FR010001,
  0 FR011001,
  0 FR012001,
  0 FR013001
 FROM  FATTURA_PASSIVA F,
  FATTURA_PASSIVA_RIGA FR,
  VOCE_IVA V ,
  TERZO T ,
  ANAGRAFICO A
 WHERE  F.CD_CDS = FR.CD_CDS AND
  F.CD_UNITA_ORGANIZZATIVA = FR.CD_UNITA_ORGANIZZATIVA AND
  F.ESERCIZIO = FR.ESERCIZIO AND
  F.PG_FATTURA_PASSIVA = FR.PG_FATTURA_PASSIVA AND
  V.CD_VOCE_IVA = FR.CD_VOCE_IVA AND
  T.CD_TERZO = F.CD_TERZO AND
  T.CD_ANAG = A.CD_ANAG AND
  F.CD_TIPO_SEZIONALE = 'a/com' AND
  F.FL_INTRA_UE = 'N'  AND
  F.FL_EXTRA_UE ='N' AND
  F.FL_SAN_MARINO_SENZA_IVA = 'N' AND
  F.STATO_COFI != 'A' AND
  F.PROTOCOLLO_IVA IS NOT NULL AND
  V.CD_VOCE_IVA = 'ES'AND
  FR.CD_BENE_SERVIZIO NOT IN ('19','19A', '19L')
 GROUP BY TO_CHAR(F.DT_FATTURA_FORNITORE, 'YYYY'),
  NULL,
  NULL,
  NULL,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA)
 UNION All
 ---- FR009001 -- FR009002 -- NOTE DI VARIAZIONE OPERAZIONI IMPONIBILI RICEVUTE ED EMESSE NELL'ANNO MA RIFERITE AD ESERCIZI PRECEDENTI ----
 SELECT   TO_NUMBER(TO_CHAR(F.DT_FATTURA_FORNITORE, 'YYYY')) ESERCIZIO ,
  NULL CL002001,
  NULL CL003001,
  0 CL004001,
  0 CL004002,
  0 CL005001,
  0 CL006001,
  0 CL007001,
  0 CL008001,
  0 CL008002,
  0 CL009001,
  0 CL010001,
  0 CL011001,
  NULL FR002001,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA) FR003001,
  0 FR004001,
  0 FR004002,
  0 FR005001,
  0 FR006001,
  0 FR007001,
  0 FR008001,
  SUM( DECODE(F.TI_FATTURA, 'C', FR.IM_IMPONIBILE, 0)) FR009001,
  SUM(DECODE(F.TI_FATTURA, 'C', FR.IM_IVA, 0)) FR009002,
  0 FR010001,
  0 FR011001,
  0 FR012001,
  0 FR013001
 FROM  FATTURA_PASSIVA F,
  FATTURA_PASSIVA_RIGA FR,
  VOCE_IVA V ,
  TERZO T ,
  ANAGRAFICO A
 WHERE  F.CD_CDS = FR.CD_CDS AND
  F.CD_UNITA_ORGANIZZATIVA = FR.CD_UNITA_ORGANIZZATIVA AND
  F.ESERCIZIO = FR.ESERCIZIO AND
  F.PG_FATTURA_PASSIVA = FR.PG_FATTURA_PASSIVA AND
  V.CD_VOCE_IVA = FR.CD_VOCE_IVA AND
  T.CD_TERZO = F.CD_TERZO AND
  T.CD_ANAG = A.CD_ANAG AND
  F.CD_TIPO_SEZIONALE = 'a/com' AND
  F.FL_INTRA_UE = 'N'  AND
  F.FL_EXTRA_UE ='N' AND
  F.FL_SAN_MARINO_SENZA_IVA = 'N' AND
  F.STATO_COFI != 'A' AND
  F.PROTOCOLLO_IVA IS NOT NULL AND
  V.CD_VOCE_IVA IN ('4%', '10%', '20%', 'NB', 'NC', 'ND')AND
  FR.CD_BENE_SERVIZIO NOT IN ('19','19A', '19L')And
  TO_CHAR(FR.DT_DA_COMPETENZA_COGE, 'YYYY') != TO_CHAR(DT_FATTURA_FORNITORE, 'YYYY')
 GROUP BY TO_CHAR(F.DT_FATTURA_FORNITORE, 'YYYY'),
  NULL,
  NULL,
  NULL,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA)
 UNION All
 ---- FR011001 -- NOTE DI VARIAZIONE OPERAZIONI NON  IMPONIBILI RICEVUTE ED EMESSE NELL'ANNO MA RIFERITE AD ESERCIZI PRECEDENTI ----
 SELECT   TO_NUMBER(TO_CHAR(F.DT_FATTURA_FORNITORE, 'YYYY')) ESERCIZIO ,
  NULL CL002001,
  NULL CL003001,
  0 CL004001,
  0 CL004002,
  0 CL005001,
  0 CL006001,
  0 CL007001,
  0 CL008001,
  0 CL008002,
  0 CL009001,
  0 CL010001,
  0 CL011001,
  NULL FR002001,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA) FR003001,
  0 FR004001,
  0 FR004002,
  0 FR005001,
  0 FR006001,
  0 FR007001,
  0 FR008001,
  0 FR009001,
  0 FR009002,
  0 FR010001,
  SUM( DECODE(F.TI_FATTURA, 'C', -FR.IM_IMPONIBILE, 0))   FR011001,
  0 FR012001,
  0 FR013001
 FROM  FATTURA_PASSIVA F,
  FATTURA_PASSIVA_RIGA FR,
  VOCE_IVA V ,
  TERZO T ,
  ANAGRAFICO A
 WHERE  F.CD_CDS = FR.CD_CDS AND
  F.CD_UNITA_ORGANIZZATIVA = FR.CD_UNITA_ORGANIZZATIVA AND
  F.ESERCIZIO = FR.ESERCIZIO AND
  F.PG_FATTURA_PASSIVA = FR.PG_FATTURA_PASSIVA AND
  V.CD_VOCE_IVA = FR.CD_VOCE_IVA AND
  T.CD_TERZO = F.CD_TERZO AND
  T.CD_ANAG = A.CD_ANAG AND
  F.CD_TIPO_SEZIONALE = 'a/com' AND
  F.FL_INTRA_UE = 'N'  AND
  F.FL_EXTRA_UE ='N' AND
  F.FL_SAN_MARINO_SENZA_IVA = 'N' AND
  F.STATO_COFI != 'A' AND
  F.PROTOCOLLO_IVA IS NOT NULL AND
  V.CD_VOCE_IVA IN ('N1', 'N2', 'N3', 'N4', 'N5', 'N8')AND
  FR.CD_BENE_SERVIZIO NOT IN ('19','19A', '19L') AND
  TO_CHAR(FR.DT_DA_COMPETENZA_COGE, 'YYYY') != TO_CHAR(DT_FATTURA_FORNITORE, 'YYYY')
 GROUP BY TO_CHAR(F.DT_FATTURA_FORNITORE, 'YYYY'),
  NULL,
  NULL,
  NULL,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA)
 UNION All
 ---- FR012001 -- NOTE DI VARIAZIONE OPERAZIONI ESENTI RICEVUTE ED EMESSE NELL'ANNO MA RIFERITE AD ESERCIZI PRECEDENTI ----
 SELECT   TO_NUMBER(TO_CHAR(F.DT_FATTURA_FORNITORE, 'YYYY')) ESERCIZIO ,
  NULL CL002001,
  NULL CL003001,
  0 CL004001,
  0 CL004002,
  0 CL005001,
  0 CL006001,
  0 CL007001,
  0 CL008001,
  0 CL008002,
  0 CL009001,
  0 CL010001,
  0 CL011001,
  NULL FR002001,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA) FR003001,
  0 FR004001,
  0 FR004002,
  0 FR005001,
  0 FR006001,
  0 FR007001,
  0 FR008001,
  0 FR009001,
  0 FR009002,
  0 FR010001,
  0 FR011001,
  SUM( DECODE(F.TI_FATTURA, 'C', -FR.IM_IMPONIBILE, 0))  FR012001,
  0 FR013001
 FROM  FATTURA_PASSIVA F,
  FATTURA_PASSIVA_RIGA FR,
  VOCE_IVA V ,
  TERZO T ,
  ANAGRAFICO A
 WHERE  F.CD_CDS = FR.CD_CDS AND
  F.CD_UNITA_ORGANIZZATIVA = FR.CD_UNITA_ORGANIZZATIVA AND
  F.ESERCIZIO = FR.ESERCIZIO AND
  F.PG_FATTURA_PASSIVA = FR.PG_FATTURA_PASSIVA AND
  V.CD_VOCE_IVA = FR.CD_VOCE_IVA AND
  T.CD_TERZO = F.CD_TERZO AND
  T.CD_ANAG = A.CD_ANAG AND
  F.CD_TIPO_SEZIONALE = 'a/com' AND
  F.FL_INTRA_UE = 'N'  AND
  F.FL_EXTRA_UE ='N' AND
  F.FL_SAN_MARINO_SENZA_IVA = 'N' AND
  F.STATO_COFI != 'A' AND
  F.PROTOCOLLO_IVA IS NOT NULL AND
  V.CD_VOCE_IVA = 'ES'AND
  FR.CD_BENE_SERVIZIO NOT IN ('19','19A', '19L') And
  TO_CHAR(FR.DT_DA_COMPETENZA_COGE, 'YYYY') != TO_CHAR(DT_FATTURA_FORNITORE, 'YYYY')
 GROUP BY TO_CHAR(F.DT_FATTURA_FORNITORE, 'YYYY'),
  NULL,
  NULL,
  NULL,
  NVL(F.PARTITA_IVA, A.PARTITA_IVA)
  )
GROUP BY ESERCIZIO,
 CL002001,
 CL003001,
 FR002001,
 FR003001);
